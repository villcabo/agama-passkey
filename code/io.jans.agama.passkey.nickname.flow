Flow io.jans.agama.passkey.nickname
     Basepath ""
     Inputs tokenResponse userData
Log "@debug **=> Nickname passkey flow started!, Inputs tokenResponse %, userData %" tokenResponse userData

inum = userData.inum
name = userData.name

nicknameForm = RRF "nickname.ftlh"
Log "@debug Nickname form response %" nicknameForm

enroller = Call io.jans.agama.passkey.enroll.FidoEnroller#new
key = Call enroller verifyRegistration inum tokenResponse
Log "@debug ID of enrolled key is" key
nickNamed = Call enroller nameIt inum nicknameForm.nickname key
When nickNamed is false
    Log "@debug Failed to set a nickname for % device" name
    res = { success: false, message: "Nickname passkey failed to save" }
    Finish res

res = { success: true, message: "Nickname passkey saved" }
Finish res
